import logging  # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–∑–∞–ø–∏—Å–∏ –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ —Ñ–∞–π–ª –∏–ª–∏ –∫–æ–Ω—Å–æ–ª—å)
from train import train_model  # –ò–º–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –∏–∑ –º–æ–¥—É–ª—è train.py
from evaluate import evaluate_model, save_f1_summary  # –ò–º–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –æ—Ü–µ–Ω–∫–∏ –º–æ–¥–µ–ª–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤

# === –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è ===
def setup_logging():
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: –≤—ã–≤–æ–¥ –ª–æ–≥–æ–≤ –≤ —Ñ–∞–π–ª –∏ –Ω–∞ —ç–∫—Ä–∞–Ω
    logging.basicConfig(
        level=logging.INFO,  # –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: INFO ‚Äî —Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
        format="%(asctime)s [%(levelname)s] %(message)s",  # –§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤ (–≤—Ä–µ–º—è, —É—Ä–æ–≤–µ–Ω—å, —Å–æ–æ–±—â–µ–Ω–∏–µ)
        datefmt="%Y-%m-%d %H:%M:%S",  # –§–æ—Ä–º–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
        handlers=[
            logging.FileHandler("results/eval.log", mode='w', encoding='utf-8'),  # –§–∞–π–ª –¥–ª—è –ª–æ–≥–æ–≤
            logging.StreamHandler()  # –í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
        ]
    )

# === –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∑–∞–ø—É—Å–∫–∞–µ–º–∞—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∫—Ä–∏–ø—Ç–∞ ===
def main():
    setup_logging()  # –ó–∞–ø—É—Å–∫–∞–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

    # –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥–µ–º –æ–±—É—á–∞—Ç—å –∏ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å
    models = ["resnet50", "efficientnet_b0", "swin_tiny"]
    f1_scores = {}  # –°–ª–æ–≤–∞—Ä—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤—ã—Ö F1-–æ—Ü–µ–Ω–æ–∫ –ø–æ –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏

    logging.info("=== –®–ê–ì 1: –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π —Å ArcFace ===")
    for model_name in models:
        train_model(model_name=model_name)  # –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

    logging.info("=== –®–ê–ì 2: –û—Ü–µ–Ω–∫–∞ –æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —Å ArcFace ===")
    for model_name in models:
        logging.info(f"üîç –û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–∏: {model_name}")
        avg_f1 = evaluate_model(model_name=model_name)  # –ü–æ–ª—É—á–∞–µ–º —Å—Ä–µ–¥–Ω—é—é F1-–æ—Ü–µ–Ω–∫—É
        f1_scores[model_name] = avg_f1  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –µ—ë –≤ —Å–ª–æ–≤–∞—Ä—å

    logging.info("=== –®–ê–ì 3: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ F1-–º–µ—Ç—Ä–∏–∫ ===")
    save_f1_summary(f1_scores)  # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É –∏ —Å—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫

    logging.info("\u2705 –û–±—É—á–µ–Ω–∏–µ –∏ –æ—Ü–µ–Ω–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ")

# === –°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã ===
if __name__ == "__main__":
    main()  # –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
